# R101协议说明
文档日期:2020.6.9

软件版本：**V0.1.3**

协议类别：modbus 和 私有协议

硬件接口：RS485

默认通讯参数：9600 8 N 1（9600波特率时，建议请求间隔>500ms）

## 1.modbus
支持**03**，**04**，**06**功能码。
### 1.1 输入寄存器
| 序号 | 地址 | 输入寄存器                     | 说明               |
| ---- | ---- | ------------------------------ | ------------------------------ |
|      | 0    | Z轴基频        | （样品默认0，1） |
|      | 1    | Z轴加速度峰值   |    （m/ss , X100）|
|      | 2    | Z轴加速度有效值 |  （m/ss , X100）|
|      | 3    | Z轴速度有效值   |  （mm/s , X100）  |
|      | 4    | Z轴位移峰峰值    |   （um ， X100）  |
|      | 5    | Z峭度指标             |    （X100）            |
|      | 6    | Z轴包络                |    （暂无）             |
| | 7 | Z轴位移有效值 | （um，X100） |
|      | ...  |                                |                                |
|      | 10    | X轴基频        | （样品默认0，1） |
|      | 11    | X轴加速度峰值   |    （m/ss , X100）|
|      | 12    | X轴加速度有效值 |  （m/ss , X100）|
|      | 13    | X轴速度有效值   |  （mm/s , X100）  |
|      | 14    | X轴位移峰峰值    |   （um ， X100）  |
|      | 15    | X峭度指标             |    （X100）            |
|      | 16    | X轴包络                |    （暂无）             |
| | 17 | X轴位移有效值 | （um，X100） |
|      |  ...    |                                |                                |
|      | 20    | Y轴基频        | （样品默认0，1） |
|      | 21    | Y轴加速度峰值   |    （m/ss , X100）|
|      | 22    | Y轴加速度有效值 |  （m/ss , X100）|
|      | 23    | Y轴速度有效值   |  （mm/s , X100）  |
|      | 24    | Y轴位移峰峰值    |   （um ， X100）  |
|      | 25    | Y峭度指标             |    （X100）            |
|      | 26    | Y轴包络                |    （暂无）             |
| | 27 | Y轴位移有效值 | （um，X100） |
|      | ...  |                                |                                |
|      |  30    | 温度                            |                                暂无|
|      | ... |  |                                |
|      | 97 | 大版本号 |                                |
|      | 98 | 中版本号 |                                |
|      | 99 | 小版本号 |                                |
|      | 100 | Z轴波形 |                                |
|      | ... |                                |                                |
|      | 2100 | X轴波形 |                                |
|      | ... |                                |                                |
|      | 4100 | Y轴波形 |                                |
|      |      |                                |                                |
|      |      |                                |                                |
|      |      |                                |                                |
|      |      |                                |                                |

### 1.2 保持寄存器
| 序号 | 地址 | 输入寄存器                     | 说明               |
| ---- | ---- | ------------------------------ | ------------------------------ |
|      | 0    | 从机地址   |      |
| | 1    | SN[0] |      |
| | 2    | SN[1] |      |
| | 3    | SN[2] |      |
| | 4    | SN[3] |      |
| | 5    | SN[4] |      |
| | 6    | SN[5] |      |
| | 7    | SN[6] |      |
| | 8    | SN[7] |      |
| | 9 | Z轴灵敏度 |      |
| | 10 | X轴灵敏度 |      |
| | 11 | Y轴灵敏度 |      |
| | 12 | FFT_LowPass |      |
| | 13 | FFT_highPass |      |
| | 14 | FFT_LowPass |      |
| | 15 | FFT_HighPass |      |
| | 16 | 温度补偿值 |      |
| | 17 | 波形记录间隔 |      |
| | 18 | 通讯波特率 |      |
| | 19 | 通讯校验 |      |
| | 20 | 通讯停止位 |      |
| | 21 | 重启 |      |
| | 22 | X轴转动角度 |      |
| |      |            |      |

#### 1.2.1 通讯参数
注：修改通讯参数后，需向寄存器21（重启）写0x0001值，使传感器重启。

**通讯波特率：**
```c
    case 0 : uartConfig.baudRate_Bps = 2400;break;
    case 1 : uartConfig.baudRate_Bps = 4800;break;
    case 2 : uartConfig.baudRate_Bps = 9600;break;
    case 3 : uartConfig.baudRate_Bps = 14400;break;
    case 4 : uartConfig.baudRate_Bps = 19200;break;
    case 5 : uartConfig.baudRate_Bps = 38400;break;
    case 6 : uartConfig.baudRate_Bps = 56000;break;
    case 7 : uartConfig.baudRate_Bps = 115200;break;
    default : uartConfig.baudRate_Bps = 9600;break;
```
**校验：**
```c
    case 0 : uartConfig.parityMode = kUART_ParityDisabled;break;
    case 1 : uartConfig.parityMode = kUART_ParityEven;break;
    case 2 : uartConfig.parityMode = kUART_ParityOdd;break;
    default : uartConfig.parityMode = kUART_ParityDisabled;break;
```
**停止位：**
```c
    case 1 : uartConfig.stopBitCount = kUART_OneStopBit;break;
    case 2 : uartConfig.stopBitCount = kUART_TwoStopBit;break;
    default : uartConfig.stopBitCount = kUART_OneStopBit;break;
```


## 2.私有协议
### 2.1 协议格式

```c
typedef struct
{
	uint8_t head;		// 固定头0x7e
	uint8_t cmd;		//命令
	uint16_t len;		// payload长度
	uint8_t * payload;
	uint8_t sum;		//和校验
	uint8_t foot;		// 固定尾0x7e

}ln_protocolintance_t;
```


### 2.2 命令

|序号|CMD|值|说明|
|---|---|---|---|
||请求SlaveID|0x80||
||应答SlaveID|0x81||
||参数复位|0x82||
|||||
|||||

#### 2.2.1 请求SlaveID  0x80
* 命令类型：请求
* payload:无

#### 2.2.2 应答SlaveID 0x81
* 命令类型：应答
* payload：
```c
{
	uint8_t SlaveID;
}
```
#### 2.2.3 参数复位 0x82
* 命令类型：请求
* payload：无










